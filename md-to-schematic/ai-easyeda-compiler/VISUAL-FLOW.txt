╔═══════════════════════════════════════════════════════════════════════════╗
║                                                                           ║
║           AI PCB DESIGN SYSTEM - VISUAL FLOW DIAGRAM                      ║
║                                                                           ║
╚═══════════════════════════════════════════════════════════════════════════╝


                    ┌─────────────────────────┐
                    │    USER CREATES         │
                    │    Markdown File        │
                    │  (inputs/my-board.md)   │
                    └───────────┬─────────────┘
                                │
                                ↓
                    ┌─────────────────────────┐
                    │  AUTO DESIGNER DETECTS  │
                    │  • npm run auto:fast    │
                    │  • Monitors inputs/     │
                    └───────────┬─────────────┘
                                │
                                ↓
                    ┌─────────────────────────┐
                    │  EXTRACT COMPONENTS     │
                    │  ESP32, BME280, LM358   │
                    └───────────┬─────────────┘
                                │
                ┌───────────────┴───────────────┐
                │                               │
                ↓                               ↓
    ┌──────────────────────┐      ┌──────────────────────┐
    │  LOCAL KNOWLEDGE?    │      │  WEB SCRAPING        │
    │  • Check cache       │  NO  │  • 11 websites       │
    │  • PDF files         │─────>│  • Multi-site        │
    └──────────┬───────────┘      └──────────┬───────────┘
               │ YES                          │
               │                              ↓
               │              ┌──────────────────────────────┐
               │              │  SITE 1: AllDataSheet.com    │
               │              │  ├─> Load page               │
               │              │  ├─> HTML: 88 KB             │
               │              │  ├─> Sanitize: 70 KB         │
               │              │  └─> Tables: 36              │
               │              └──────────┬───────────────────┘
               │                         │
               │              ┌──────────▼───────────────────┐
               │              │  SITE 2: Octopart.com        │
               │              │  ├─> Load page               │
               │              │  ├─> HTML: 1.4 MB            │
               │              │  ├─> Sanitize: 817 KB        │
               │              │  └─> Tables: 9               │
               │              └──────────┬───────────────────┘
               │                         │
               │              ┌──────────▼───────────────────┐
               │              │  SITES 3-11: TI, ST, etc.    │
               │              │  (Repeat process)            │
               │              └──────────┬───────────────────┘
               │                         │
               └─────────────────────────┘
                             │
                             ↓
              ┌──────────────────────────────────┐
              │  COMPILE BULK DATA               │
              │  • 11 sources                    │
              │  • 45 tables                     │
              │  • 50,000 characters             │
              │  • Structured JSON               │
              └──────────────┬───────────────────┘
                             │
                             ↓
              ┌──────────────────────────────────┐
              │  SEND TO OLLAMA                  │
              │  ┌────────────────────────────┐  │
              │  │  Model: DeepSeek-R1:7b     │  │
              │  │  Prompt: 30,000 chars      │  │
              │  │  Task: Extract specs       │  │
              │  └────────────┬───────────────┘  │
              └───────────────┼──────────────────┘
                              │
                              ↓
              ┌──────────────────────────────────┐
              │  OLLAMA RESPONSE                 │
              │  {                               │
              │    voltage: "3V-30V",            │
              │    current: "80µA",              │
              │    package: ["DIP-8", "SOIC"],   │
              │    manufacturer: "TI"            │
              │  }                               │
              └──────────────┬───────────────────┘
                             │
             ┌───────────────┼───────────────┐
             │               │               │
             ↓               ↓               ↓
┌────────────────┐ ┌─────────────────┐ ┌────────────────┐
│  GENERATE      │ │  GENERATE       │ │  GENERATE      │
│  PIN TABLE     │ │  SCHEMATIC      │ │  BOM           │
│  • All pins    │ │  • EasyEDA JSON │ │  • LCSC parts  │
│  • Functions   │ │  • Components   │ │  • Markdown    │
└────────┬───────┘ └────────┬────────┘ └────────┬───────┘
         │                  │                   │
         └──────────────────┼───────────────────┘
                            │
                            ↓
              ┌──────────────────────────────────┐
              │  OUTPUT FILES GENERATED          │
              │  ✅ schematic.json               │
              │  ✅ bom.md                       │
              │  ✅ pin-table.md                 │
              │  ✅ design-report.md             │
              └──────────────┬───────────────────┘
                             │
                             ↓
              ┌──────────────────────────────────┐
              │  QUALITY EVALUATION              │
              │  • Score: 0-100                  │
              │  • Grade: A/B/C/D                │
              │  • Check: EMI, ESD, derating     │
              └──────────────┬───────────────────┘
                             │
                             ↓
              ┌──────────────────────────────────┐
              │  LEARNING & IMPROVEMENT          │
              │  • Track success/failures        │
              │  • Generate new rules            │
              │  • Update patterns               │
              └──────────────┬───────────────────┘
                             │
                             ↓
                    ┌─────────────────┐
                    │  DESIGN READY!  │
                    │  Import to      │
                    │  EasyEDA        │
                    └─────────────────┘


═══════════════════════════════════════════════════════════════════════════

                        MULTI-SITE SCRAPER DETAIL

                    Component: "LM358"
                            │
        ┌───────────────────┼───────────────────┐
        │                   │                   │
        ↓                   ↓                   ↓
┌───────────────┐  ┌───────────────┐  ┌───────────────┐
│ AllDataSheet  │  │   Octopart    │  │ Texas Inst.   │
│ ────────────  │  │ ────────────  │  │ ────────────  │
│ Load: 3s      │  │ Load: 5s      │  │ Load: 4s      │
│ HTML: 88 KB   │  │ HTML: 1.4 MB  │  │ HTML: 250 KB  │
│ Clean: 70 KB  │  │ Clean: 817 KB │  │ Clean: 180 KB │
│ Tables: 36    │  │ Tables: 9     │  │ Tables: 12    │
└───────┬───────┘  └───────┬───────┘  └───────┬───────┘
        │                   │                   │
        └───────────────────┼───────────────────┘
                            │
        ┌───────────────────┴───────────────────┐
        │                                       │
        ↓                                       ↓
┌───────────────┐                      ┌───────────────┐
│ Microchip     │       ...            │ Espressif     │
│ ────────────  │                      │ ────────────  │
│ + 7 more      │                      │ (Site 11)     │
│ sites         │                      │               │
└───────┬───────┘                      └───────┬───────┘
        │                                       │
        └───────────────────┬───────────────────┘
                            │
                            ↓
              ┌──────────────────────────────┐
              │  BULK DATA: 30 KB            │
              │  • From 11 sources           │
              │  • 45 tables total           │
              │  • Complete specs            │
              └──────────────┬───────────────┘
                             │
                             ↓
                    [Send to Ollama]


═══════════════════════════════════════════════════════════════════════════

                    HTML SANITIZATION PIPELINE

    Raw HTML (88 KB)
         │
         ↓
    ┌────────────────────────┐
    │ Remove <script> tags   │ -15 KB
    └────────┬───────────────┘
             ↓
    ┌────────────────────────┐
    │ Remove <style> tags    │ -3 KB
    └────────┬───────────────┘
             ↓
    ┌────────────────────────┐
    │ Remove comments        │ -0.5 KB
    └────────┬───────────────┘
             ↓
    ┌────────────────────────┐
    │ Remove inline styles   │ -2 KB
    └────────┬───────────────┘
             ↓
    ┌────────────────────────┐
    │ Clean whitespace       │ -0.5 KB
    └────────┬───────────────┘
             ↓
    Clean HTML (70 KB)
    • 20% reduction
    • Pure content
    • Ready for AI


═══════════════════════════════════════════════════════════════════════════

                    SECTION EXTRACTION DETAIL

    Sanitized HTML
         │
         ├──────────────────┬──────────────────┬──────────────┐
         │                  │                  │              │
         ↓                  ↓                  ↓              ↓
    ┌─────────┐      ┌──────────┐      ┌──────────┐  ┌──────────┐
    │ Tables  │      │  Specs   │      │Metadata  │  │   Text   │
    │ ─────── │      │ ───────  │      │ ──────── │  │ ──────── │
    │ Find    │      │ Find     │      │ Extract  │  │ Extract  │
    │ <table> │      │ class=   │      │ <meta>   │  │ body     │
    │ Parse   │      │ "spec"   │      │ tags     │  │ innerText│
    │ headers │      │ Extract  │      │ Result:  │  │ Result:  │
    │ Parse   │      │ text     │      │ 11 tags  │  │ 9.5K     │
    │ rows    │      │ Result:  │      │          │  │ chars    │
    │ Result: │      │ 5 items  │      │          │  │          │
    │ 36      │      │          │      │          │  │          │
    └────┬────┘      └────┬─────┘      └────┬─────┘  └────┬─────┘
         │                │                  │             │
         └────────────────┴──────────────────┴─────────────┘
                             │
                             ↓
                    ┌────────────────┐
                    │ Sections JSON  │
                    │ {              │
                    │   tables: 36,  │
                    │   specs: 5,    │
                    │   metadata:{}, │
                    │   text: "..."  │
                    │ }              │
                    └────────────────┘


═══════════════════════════════════════════════════════════════════════════

                    FILE STORAGE STRUCTURE

knowledge-base/
├── html-storage/                 ← Raw HTML from websites
│   ├── LM358_alldatasheet.html      88 KB
│   ├── LM358_octopart.html          1.4 MB
│   ├── LM358_ti.html                250 KB
│   └── ... (11 files per component)
│
├── html-sanitized/               ← Cleaned HTML
│   ├── LM358_alldatasheet_clean.html   70 KB
│   ├── LM358_octopart_clean.html       817 KB
│   └── ... (11 files per component)
│
├── html-sections/                ← Extracted sections
│   ├── LM358_alldatasheet_sections.json
│   │   • tables: 36
│   │   • specs: 5
│   │   • text: 9,547 chars
│   └── ... (11 files per component)
│
└── ollama-extractions/           ← AI results
    ├── LM358_ollama.json            Response from Ollama
    └── LM358_FINAL.json             Complete extraction


═══════════════════════════════════════════════════════════════════════════

                    COMMAND FLOW

    $ npm run auto:fast
            │
            ↓
    Monitor inputs/*.md
            │
            ↓
    Found: my-board.md
            │
            ↓
    Extract: [ESP32, BME280, LM358]
            │
            ↓
    ┌───────────────┐
    │  For ESP32:   │
    │  $ npm run    │
    │  scrape:multi │
    │  ESP32        │
    └───────┬───────┘
            │
            ↓
    Search 11 sites → Save HTML → Extract → Ollama
            │
            ↓
    ┌───────────────┐
    │  For BME280:  │
    │  (repeat)     │
    └───────┬───────┘
            │
            ↓
    ┌───────────────┐
    │  For LM358:   │
    │  (repeat)     │
    └───────┬───────┘
            │
            ↓
    All specs collected
            │
            ↓
    Generate pin tables
            │
            ↓
    Call Ollama for schematic
            │
            ↓
    Convert to EasyEDA JSON
            │
            ↓
    Generate BOM
            │
            ↓
    Create documentation
            │
            ↓
    ✅ COMPLETE!


═══════════════════════════════════════════════════════════════════════════

                    SUCCESS METRICS

Component Scraping:
  ├─> 11 websites searched
  ├─> 2-3 minutes per component
  ├─> 70-80% success rate (8-9 sites)
  └─> 30 KB data to Ollama

Data Storage:
  ├─> 2-3 MB raw HTML
  ├─> 1-1.5 MB sanitized
  ├─> 40-50 tables extracted
  └─> Complete specifications

Schematic Generation:
  ├─> 2-5 minutes with Ollama
  ├─> EasyEDA JSON format
  ├─> Ready to import
  └─> 90%+ success rate

Total Time:
  └─> 5-10 minutes per board


╔═══════════════════════════════════════════════════════════════════════════╗
║                                                                           ║
║                    SYSTEM FLOW - COMPLETE!                                ║
║                                                                           ║
║  ✅ Multi-site scraping (11 websites)                                    ║
║  ✅ HTML sanitization (20% reduction)                                    ║
║  ✅ Section extraction (tables, specs, text)                             ║
║  ✅ Ollama integration (30 KB bulk data)                                 ║
║  ✅ Auto PCB designer (end-to-end)                                       ║
║  ✅ Quality evaluation (scoring)                                         ║
║  ✅ Learning loop (continuous improvement)                               ║
║                                                                           ║
║  Status: Production Ready                                                 ║
║                                                                           ║
╚═══════════════════════════════════════════════════════════════════════════╝

🔄🚀✨
